<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tub Lifter</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #1a1a2e;
            color: #eee;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            text-align: center;
            padding: 2rem;
            width: 100%;
            max-width: 400px;
        }

        h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            color: #e2e2e2;
        }

        .subtitle {
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 2.5rem;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .btn {
            padding: 1.2rem 2rem;
            font-size: 1.3rem;
            font-weight: 700;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.2s;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .btn:active {
            transform: scale(0.97);
        }

        .btn-extend {
            background: linear-gradient(135deg, #00b4d8, #0077b6);
            color: #fff;
            box-shadow: 0 4px 15px rgba(0, 180, 216, 0.3);
        }
        .btn-extend:hover {
            box-shadow: 0 6px 20px rgba(0, 180, 216, 0.5);
        }

        .btn-retract {
            background: linear-gradient(135deg, #f77f00, #e36414);
            color: #fff;
            box-shadow: 0 4px 15px rgba(247, 127, 0, 0.3);
        }
        .btn-retract:hover {
            box-shadow: 0 6px 20px rgba(247, 127, 0, 0.5);
        }

        .btn-stop {
            background: linear-gradient(135deg, #d62828, #9b2226);
            color: #fff;
            box-shadow: 0 4px 15px rgba(214, 40, 40, 0.3);
            padding: 0.8rem 2rem;
            font-size: 1rem;
        }
        .btn-stop:hover {
            box-shadow: 0 6px 20px rgba(214, 40, 40, 0.5);
        }

        .status-bar {
            margin-top: 2rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            font-size: 0.85rem;
            color: #aaa;
            min-height: 3rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .status-bar.ok { color: #4ade80; }
        .status-bar.error { color: #f87171; }

        .position-display {
            margin-top: 1rem;
            padding: 0.8rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            display: none;
        }

        .position-bar-track {
            height: 8px;
            background: #333;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .position-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #00b4d8, #0077b6);
            border-radius: 4px;
            width: 0%;
            transition: width 0.3s;
        }

        .section-label {
            font-size: 0.75rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .section-label:first-of-type {
            margin-top: 0;
        }

        .position-label {
            font-size: 0.8rem;
            color: #888;
            display: flex;
            justify-content: space-between;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Tub Lifter</h1>
        <p class="subtitle">Thomson Electrak HD</p>

        <p class="section-label">Hold to move</p>
        <div class="controls">
            <button class="btn btn-extend" id="holdExtend">Extend</button>
            <button class="btn btn-retract" id="holdRetract">Retract</button>
        </div>

        <p class="section-label">Go to position</p>
        <div class="controls">
            <button class="btn btn-extend" onclick="sendCommand('extend')">Full Extend</button>
            <button class="btn btn-retract" onclick="sendCommand('retract')">Full Retract</button>
            <button class="btn btn-stop" onclick="sendCommand('stop')">Stop</button>
        </div>

        <div class="status-bar" id="status">Ready</div>

        <div class="position-display" id="positionDisplay">
            <div class="position-label">
                <span>Position</span>
                <span id="positionValue">--</span>
            </div>
            <div class="position-bar-track">
                <div class="position-bar-fill" id="positionBar"></div>
            </div>
        </div>
    </div>

    <script>
        const statusEl = document.getElementById("status");
        const posDisplay = document.getElementById("positionDisplay");
        const posBar = document.getElementById("positionBar");
        const posValue = document.getElementById("positionValue");
        const STROKE_MM = 1000;

        async function sendCommand(action) {
            statusEl.className = "status-bar";
            statusEl.textContent = "Sending...";

            try {
                const res = await fetch(`/api/${action}`, { method: "POST" });
                const data = await res.json();

                if (data.ok) {
                    statusEl.className = "status-bar ok";
                    statusEl.textContent = action === "stop"
                        ? "Stopped"
                        : `${action.charAt(0).toUpperCase() + action.slice(1)}ing...`;
                } else {
                    statusEl.className = "status-bar error";
                    statusEl.textContent = data.error || "Command failed";
                }
            } catch (e) {
                statusEl.className = "status-bar error";
                statusEl.textContent = "Connection error";
            }
        }

        async function pollStatus() {
            try {
                const res = await fetch("/api/status");
                const data = await res.json();
                if (data.ok && data.valid) {
                    posDisplay.style.display = "block";
                    const pct = (data.position_mm / STROKE_MM) * 100;
                    posBar.style.width = pct + "%";
                    posValue.textContent = `${data.position_mm.toFixed(1)} mm`;
                }
            } catch {}
        }

        setInterval(pollStatus, 500);

        // Hold-to-move buttons: extend/retract while pressed, stop on release
        function setupHoldButton(btnId, action) {
            const btn = document.getElementById(btnId);
            let active = false;

            function start(e) {
                e.preventDefault();
                if (active) return;
                active = true;
                sendCommand(action);
            }

            function end(e) {
                e.preventDefault();
                if (!active) return;
                active = false;
                sendCommand('stop');
            }

            btn.addEventListener('mousedown', start);
            btn.addEventListener('mouseup', end);
            btn.addEventListener('mouseleave', end);
            btn.addEventListener('touchstart', start);
            btn.addEventListener('touchend', end);
            btn.addEventListener('touchcancel', end);
        }

        setupHoldButton('holdExtend', 'extend');
        setupHoldButton('holdRetract', 'retract');
    </script>
</body>
</html>
